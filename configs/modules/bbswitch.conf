# bbswitch kernel module configuration
# Controls NVIDIA GPU power state in hybrid setups

# Load bbswitch module with NVIDIA GPU initially off
# load_state=0: GPU off at module load
# unload_state=1: GPU on at module unload (for safe shutdown)
options bbswitch load_state=0 unload_state=1

# Additional bbswitch configuration for better power management
# Skip if NVIDIA GPU is not present (prevents errors on other systems)
install bbswitch /sbin/modprobe --ignore-install bbswitch && echo OFF > /proc/acpi/bbswitch 2>/dev/null || true
remove bbswitch /sbin/modprobe -r --ignore-remove bbswitch && echo ON > /proc/acpi/bbswitch 2>/dev/null || true

# Blacklist nouveau driver to prevent conflicts with NVIDIA proprietary driver
blacklist nouveau

# NVIDIA driver module configuration
# Enable modesetting for better compatibility
options nvidia-drm modeset=1

# NVIDIA power management options
options nvidia NVreg_DynamicPowerManagement=0x02
options nvidia NVreg_EnableGpuFirmware=1